<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Дыхание Грома — Аниме-стиль</title>
<style>
/* ------------------------------
   Палитра и базовые стили
   ------------------------------ */
:root{
  --bg-deep: #0b1230;    /* глубокое ночное небо */
  --mid-indigo: #12183a;
  --peach-1: #ffd9c2;
  --peach-2: #ffc6a3;
  --neon: #8de0ff;       /* неоновое свечение для молний */
  --accent-dark: #071a2b;
  --muted: #9aa6b0;
  --glass: rgba(255,255,255,0.06);
  --card-radius:16px;
  --max-w:1150px;
  font-family: "Inter", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  color: #e9f6ff;
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-deep), #0e1730 60%);overflow-y:auto}

/* Canvas layer is behind content */
#anime-bg{position:fixed;left:0;top:0;width:100%;height:100%;z-index:0;pointer-events:none;mix-blend-mode:screen}

/* Header */
.header{
  position:sticky;top:12px;z-index:30;margin:12px auto;padding:12px 18px;max-width:calc(var(--max-w) - 40px);
  background:linear-gradient(180deg, rgba(20,28,56,0.6), rgba(16,22,44,0.45));
  border-radius:14px;backdrop-filter: blur(6px);display:flex;align-items:center;justify-content:space-between;gap:12px;
  box-shadow: 0 14px 40px rgba(2,7,20,0.5);
}
.brand{display:flex;gap:12px;align-items:center}
.logo{
  width:64px;height:64px;border-radius:12px;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(180deg,#ffdfc6,#ffcaa6);color:var(--accent-dark);font-weight:900;font-size:22px;
  box-shadow: 0 6px 24px rgba(0,0,0,0.45), 0 0 28px rgba(141,224,255,0.06) inset;
}
.title{font-size:18px;font-weight:800;color:#fff}
.subtitle{font-size:12px;color:var(--muted)}

/* Navigation */
.nav{display:flex;gap:10px}
.nav button{
  background:transparent;border:0;color:#dbefff;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;
  transition:all .18s ease;
}
.nav button:hover{transform:translateY(-3px); color: #fff}
.nav .active{background:linear-gradient(180deg,#2b3b6f,#22305a);box-shadow:0 8px 24px rgba(11,26,60,0.5)}

/* Container */
.container{position:relative;z-index:10;max-width:var(--max-w);margin:28px auto;padding:28px;border-radius:18px;overflow:hidden}
.panel-wrap{
  display:grid;grid-template-columns:1fr 360px;gap:28px;align-items:start;
}
max-width:980px{ .panel-wrap{grid-template-columns:1fr} }

/* Cards */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  border-radius:var(--card-radius);padding:20px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 34px rgba(0,0,0,0.55);
}
h2{margin:0;color:#fff}
.small{font-size:13px;color:var(--muted)}

/* Photos block — anime frames */
.photos{display:flex;gap:14px;margin-top:18px;flex-wrap:wrap}
.photo-card{
  flex:1 1 calc(33.333% - 10px);min-width:160px;height:170px;border-radius:12px;position:relative;overflow:hidden;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .2s ease;
}
.photo-card:hover{transform:translateY(-6px)}
.photo-card img{width:100%;height:100%;object-fit:cover;display:block}
.photo-meta{
  position:absolute;left:8px;bottom:8px;padding:6px 10px;border-radius:10px;background:linear-gradient(90deg, rgba(0,0,0,0.45), rgba(0,0,0,0.25));
  font-size:13px;color:#fff;backdrop-filter: blur(4px);
}

/* Ranks & dress */
.ranks{display:flex;flex-direction:column;gap:12px;margin-top:12px}
.rank{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-left:5px solid #ffcc9e}
.requirements{color:var(--muted);margin-top:6px}

/* Dress grid */
.dress-list{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
@media


x-width:720px){ .dress-list{grid-template-columns:1fr} }
.dress-item{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}

/* Buttons (anime glow) */
.btn{
  padding:10px 14px;border-radius:12px;border:0;background:linear-gradient(180deg,#2b3b6f,#233059);color:#fff;font-weight:800;cursor:pointer;
  box-shadow:0 10px 28px rgba(27,40,80,0.6), 0 0 18px rgba(141,224,255,0.03);position:relative;overflow:hidden;
}
.btn:active{transform:translateY(2px)}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#e6f7ff}

/* tilt */
.tilt{transform-style:preserve-3d;transition:transform .18s cubic-bezier(.2,.9,.2,1);will-change:transform}

/* panels */
.panel{display:none;opacity:0;transform:translateY(10px);transition:opacity .36s ease, transform .36s ease}
.panel.active{display:block;opacity:1;transform:translateY(0)}

/* footer */
footer{margin-top:22px;text-align:center;color:var(--muted);font-size:13px}

/* small outline for accessibility */
button:focus{outline:3px solid rgba(141,224,255,0.12);outline-offset:4px}

/* Decorative anime UI lines */
.anime-frame{
  position:absolute;pointer-events:none;border-radius:12px;left:8px;right:8px;top:8px;height:120px;
  background:linear-gradient(90deg, rgba(255,210,180,0.03), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.02);
  box-shadow: inset 0 -40px 80px rgba(255,150,120,0.02);
  filter:blur(12px);transform:translateZ(0);
}

/* small helper for neon outlines on hover */
.neon-hover:hover{box-shadow:0 6px 30px rgba(141,224,255,0.08), 0 0 28px rgba(141,224,255,0.06)}
</style>
</head>
<body>

<!-- Canvas for anime clouds & lightning -->
<canvas id="anime-bg" aria-hidden="true"></canvas>

<header class="header" role="banner">
  <div class="brand">
    <div class="logo">DG</div>
    <div>
      <div class="title">Дыхание Грома — Аниме-офиц.</div>
      <div class="subtitle">Отряд — Garry's Mod</div>
    </div>
  </div>

  <nav class="nav" role="navigation" aria-label="Разделы">
    <button class="nav-btn active" data-tab="home">Главная</button>
    <button class="nav-btn" data-tab="ranks">Система повышений</button>
    <button class="nav-btn" data-tab="dress">Дресс-код</button>
  </nav>
</header>

<main class="container" role="main">
  <div class="panel-wrap">
    <!-- Левый столбец -->
    <section>
      <!-- Home -->
      <div id="home" class="panel active">
        <article class="card tilt" id="history-card">
          <div class="anime-frame" style="top:10px;left:12px;right:auto;width:160px;height:80px;"></div>
          <h2>Наша история — в стиле аниме</h2>
          <p>
            Официальный отряд «Дыхание Грома» — ролевой коллектив Garry's Mod. Эта страница — эстетический журнал отряда:
            тут хранятся истории, фотографии операций и правила. Стиль — аниме-грозовой, с энергией и драмой.
          </p>
          <p class="small">Замените текст на свою подробную хронику: ключевые операции, даты и важные игроки.</p>

          <div class="hr" style="height:1px;margin:14px 0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.03),transparent)"></div>

          <h3 style="margin-bottom:10px">Фотографии (примерные кадры)</h3>
          <div class="photos" aria-label="Фотослоты">
            <label class="photo-card" title="Нажмите для загрузки">
              <input type="file" accept="image/*" style="display:none" data-slot="0">
              <div style="text-align:center">
                <svg width="56" height="56" viewBox="0 0 24 24" fill="none" style="opacity:0.85">
                  <path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4V7z" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M8 14l2.5-3L13 16l3-5 3 6" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="photo-meta">Фото 1</div>
            </label>

            <label clas


s="photo-card" title="Нажмите для загрузки">
              <input type="file" accept="image/*" style="display:none" data-slot="1">
              <div style="text-align:center">
                <svg width="56" height="56" viewBox="0 0 24 24" fill="none" style="opacity:0.85">
                  <path d="M12 2v20" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M3 7h18" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="photo-meta">Фото 2</div>
            </label>

            <label class="photo-card" title="Нажмите для загрузки">
              <input type="file" accept="image/*" style="display:none" data-slot="2">
              <div style="text-align:center">
                <svg width="56" height="56" viewBox="0 0 24 24" fill="none" style="opacity:0.85">
                  <path d="M5 12h14M8 16h8" stroke="#fff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="photo-meta">Фото 3</div>
            </label>
          </div>
        </article>
      </div>

      <!-- Ranks -->
      <div id="ranks" class="panel" aria-labelledby="ranks-title">
        <article class="card tilt" id="ranks-card">
          <h2 id="ranks-title">Система повышений</h2>
          <p class="small">Аниме-стилизованная система — официальная, понятная, с визуальными метками.</p>

          <div class="ranks" role="list">
            <div class="rank" role="listitem">
              <h4>Новобранец</h4>
              <div class="requirements">Вводный курс, 2 недели активности, 3 тренировки.</div>
            </div>

            <div class="rank" role="listitem">
              <h4>Штурмовик</h4>
              <div class="requirements">10 операций, умение работать в связке, знание тактик.</div>
            </div>

            <div class="rank" role="listitem">
              <h4>Сержант</h4>
              <div class="requirements">Управление отрядом, успешное руководство операциями, отчёты.</div>
            </div>

            <div class="rank" role="listitem">
              <h4>Офицер</h4>
              <div class="requirements">Проведение занятий, 30+ часов ролевой активности.</div>
            </div>

            <div class="rank" role="listitem">
              <h4>Командир</h4>
              <div class="requirements">Назначение; стратегическое мышление и вклад в сообщество.</div>
            </div>
          </div>

          <div style="height:10px"></div>
          <p class="small muted">Совет: добавьте иконки-эмблемы для каждого ранга (аниме-стикеры выглядят круто).</p>
        </article>
      </div>

      <!-- Dress -->
      <div id="dress" class="panel" aria-labelledby="dress-title">
        <article class="card tilt" id="dress-card">
          <h2 id="dress-title">Дресс-код</h2>
          <p class="small">Аниме-эстетика — аккуратные элементы формы, фирменная палитра.</p>

          <div class="dress-list" role="list">
            <div class="dress-item" role="listitem">
              <h5>Основной комплект</h5>
              <div class="small">Тёмно-индиго жилет, персиковая эмблема «DG», тактические штаны.</div>
            </div>

            <div class="dress-item" role="listitem">
              <h5>Офицерский</h5>
              <div class="small">Светлая куртка, дополнительные знаки, плащ при церемониях (аниме-стиль).</div>
            </div>

            <div class="dress-item" role="listitem">
              <h5>Оперативный</h5>
              <div class="small">Камуфляж персиково-песочный, каска, очки.</div>
            </div>

            <div class="dress-item" role="listitem">
              <h5>Запрещено</h5>
              <div class="small">Неоновые костюмы, символика чужих фракций.</div>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- Правый столбец (aside) -->
    <aside>
      <div class="card">
        <h3>Коротко</h3>
        <div class="sma


ll" style="color:#fff;margin-bottom:8px"><strong>Дыхание Грома</strong> — аниме-версия</div>
        <div class="small">Платформа: Garry's Mod</div>

        <div style="height:12px"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="download-html">Скачать HTML</button>
          <button class="btn secondary" id="toggle-light">Молнии: Вкл</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card small">
        <h4>Интерактив</h4>
        <p class="small">Перемещай курсор — облака и сияние реагируют. Клик — аниме-молния. Кнопки подсвечиваются.</p>
      </div>
    </aside>
  </div>

  <footer>
    © <span id="year"></span> Дыхание Грома — Аниме-шаблон.
  </footer>
</main>

<script>
/* ===========================
   Core UI features: tabs, uploads, tilt, download button
   =========================== */
document.addEventListener('DOMContentLoaded', ()=> {
  // Tabs
  const navBtns = document.querySelectorAll('.nav-btn');
  navBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      navBtns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      document.querySelectorAll('.panel').forEach(p=>{
        if(p.id === tab){ p.classList.add('active'); p.scrollIntoView({behavior:'smooth', block:'start'}); }
        else p.classList.remove('active');
      });
    });
  });

  // Photo uploads: preview
  function handleFileInput(input){
    const file = input.files && input.files[0];
    if(!file) return;
    const reader = new FileReader();
    const card = input.closest('.photo-card');
    reader.onload = e => {
      card.innerHTML = '<img src="'+e.target.result+'" alt="Фото отряда">';
    };
    reader.readAsDataURL(file);
  }
  document.querySelectorAll('input[type=file]').forEach(inp=>{
    inp.addEventListener('change', ()=> handleFileInput(inp));
    const label = inp.closest('label');
    // drag & drop
    label.addEventListener('dragover', e=>{ e.preventDefault(); label.style.borderColor='rgba(141,224,255,0.14)'; });
    label.addEventListener('dragleave', e=>{ label.style.borderColor=''; });
    label.addEventListener('drop', e=>{ e.preventDefault(); label.style.borderColor=''; if(e.dataTransfer.files){ inp.files = e.dataTransfer.files; handleFileInput(inp); }});
    // click handler to open file input (labels have input hidden)
    label.addEventListener('click', ()=> inp.click());
  });

  // Tilt for cards
  const tiltEls = document.querySelectorAll('.tilt');
  tiltEls.forEach(el=>{
    el.addEventListener('mousemove', (e)=>{
      const r = el.getBoundingClientRect();
      const px = (e.clientX - r.left) / r.width;
      const py = (e.clientY - r.top) / r.height;
      const rx = (py - 0.5) * 6;
      const ry = (px - 0.5) * -6;
      el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg)`;
    });
    el.addEventListener('mouseleave', ()=> el.style.transform = 'perspective(900px) rotateX(0deg) rotateY(0deg)');
  });

  // Download
  document.getElementById('download-html').addEventListener('click', ()=>{
    const doctype = '<!doctype html>\\n';
    const html = document.documentElement.outerHTML;
    const blob = new Blob([doctype + html], {type:'text/html;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'dyhanie_groma_anime.html';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });

  // lightning toggle (simple)
  const toggle = document.getElementById('toggle-light');
  let lightningOn = true;
  toggle.addEventListener('click', ()=>{
    lightningOn = !lightningOn;
    toggle.textContent = lightningOn ? 'Молнии: Вкл' : 'Молнии: Выкл';
    window.ANIME_LIGHTING = lightningOn;
  });

  document.getElementById('year').textContent = new Date().getFullYear();
});

/* ===========================
   Anime background: layered stylized clouds + neon lightning
   Canvas draws:
   - moving stylized cloud layers (parallax)
   - ani


mated lightning bolts (stylized anime strokes)
   - soft glow / particles
   =========================== */
(function(){
  const canvas = document.getElementById('anime-bg');
  const ctx = canvas.getContext('2d', {alpha:true});
  let W = canvas.width = innerWidth;
  let H = canvas.height = innerHeight;

  // responsiveness
  window.addEventListener('resize', ()=> { W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

  // mouse trail for parallax
  const mouse = {x: W/2, y: H/2, vx:0, vy:0};
  const trail = [];
  const maxTrail = 18;

  window.addEventListener('mousemove', (e)=>{
    mouse.vx = e.clientX - mouse.x; mouse.vy = e.clientY - mouse.y;
    mouse.x = e.clientX; mouse.y = e.clientY;
    trail.push({x:mouse.x, y:mouse.y, t:performance.now()});
    if(trail.length > maxTrail) trail.shift();

    // spawn small lightning on quick moves
    if(Math.abs(mouse.vx) + Math.abs(mouse.vy) > 18 && Math.random() < 0.35){
      spawnBolt(mouse.x, mouse.y, 0.8);
    }
  });

  // click big lightning
  window.addEventListener('click', (e)=>{
    spawnBolt(e.clientX, e.clientY, 1.6, true);
    heavyFlash();
  });

  // cloud layers
  const layers = [];
  const layerCount = 4;
  for(let i=0;i<layerCount;i++){
    layers.push({
      offsetX: 0,
      speed: 0.12 + i*0.05,
      scale: 1 + i*0.08,
      y: H * (0.08 + i*0.18),
      alpha: 0.12 + i*0.06,
      hue: 210 - i*6
    });
  }

  // lightning bolts
  const bolts = [];

  function rand(min,max){ return min + Math.random()*(max-min) }

  function spawnBolt(x,y,intensity=1,branch=false){
    // limit if disabled
    if(window.ANIME_LIGHTING === false) return;
    const len = 140 + Math.random()*220;
    const angle = (-Math.PI/2) + (Math.random()-0.5) * Math.PI * 0.6; // mostly downward/godray
    const ex = x + Math.cos(angle) * len;
    const ey = y + Math.sin(angle) * len;
    bolts.push({
      x,y,ex,ey,life:1,decay:0.02 + Math.random()*0.04, width:2.0*intensity, hue: 185 + Math.random()*40, branch
    });
  }

  // flash overlay
  let flash = 0;

  function heavyFlash(){ flash = Math.max(flash, 0.9); }

  // particles (sparkles)
  const particles = [];

  function spawnParticles(x,y, count=10){
    for(let i=0;i<count;i++){
      particles.push({
        x,y,
        vx: (Math.random()-0.5)*6,
        vy: (Math.random()-1.5)*6,
        life: 1, decay: 0.02 + Math.random()*0.04,
        r: 1 + Math.random()*2,
        hue: 200 + Math.random()*60
      });
    }
  }

  // draw stylized cloud shape (smooth blob) using bezier-ish shapes
  function drawCloudLayer(layer, t){
    const baseY = layer.y + Math.sin(t * 0.0006 * (1 + layer.speed)) * 18;
    // create gradient
    const g = ctx.createLinearGradient(0, baseY - 180*layer.scale, 0, baseY + 80*layer.scale);
    g.addColorStop(0, `rgba(20,28,56,${0.0 + layer.alpha})`);
    g.addColorStop(0.5, `rgba(30,38,66,${0.22 * layer.alpha})`);
    g.addColorStop(1, `rgba(220,170,140,${0.02 * layer.alpha})`);
    ctx.fillStyle = g;
    ctx.beginPath();
    const steps = 8;
    const wave = 80 * layer.scale;
    const segW = W / (steps - 1);
    ctx.moveTo(-segW, baseY + 40*layer.scale);
    for(let i=0;i<=steps;i++){
      const px = i * segW + (layer.offsetX % (segW*2)) - segW;
      const nx = px + Math.sin((t*0.0008 + i) * 1.4) * (12 * layer.scale);
      const ny = baseY + Math.cos((t*0.001 + i) * 0.9) * (18 * layer.scale) - Math.abs(Math.sin((i/steps)*Math.PI))*wave;
      ctx.quadraticCurveTo(px, ny - 22*layer.scale, nx, ny);
    }
    ctx.lineTo(W + segW, H + 200);
    ctx.lineTo(-segW, H + 200);
    ctx.closePath();
    ctx.fill();
  }

  // Main loop
  let last = performance.now();
  function loop(now){
    const dt = now - last; last = now;
    ctx.clearRect(0,0,W,H);

    // background gradient (deep)
    const bg = ctx.createLinearGradient(0,0,0,H);
    bg.addColorStop(0, '#081025');
    bg.addColorStop(1, '#081226');
    ctx.fillStyle = bg;
    ctx.fillRect(0,0,W,H);

    // update cloud layers offsets (parallax using mouse x)
    for(let i=0;i<layers.length;i++){
      const L = layers[i];
      //

react to mouse with parallax and slow drift
      const target = (mouse.x - W/2) * 0.02 * (i+1);
      L.offsetX += (target - L.offsetX) * 0.08;
      L.offsetX += Math.sin(now*0.0002*(i+1))*0.2;
      drawCloudLayer(L, now);
    }

    // glow following cursor (soft anime glow)
    for(let j=trail.length-1;j>=0;j--){
      const p = trail[j];
      const age = (now - p.t) / 900;
      if(age > 1) continue;
      const a = (1 - age) * 0.16;
      const r = 80 + (1-age)*60;
      const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, r);
      grad.addColorStop(0, `rgba(141,224,255,${a})`);
      grad.addColorStop(1, 'rgba(255,200,170,0)');
      ctx.fillStyle = grad;
      ctx.fillRect(p.x-r, p.y-r, r*2, r*2);
    }

    // draw lightning bolts (anime style)
    for(let i=bolts.length-1;i>=0;i--){
      const b = bolts[i];
      // dynamic segments with sharp style
      const segs = 10 + Math.floor(Math.random()*6);
      ctx.globalCompositeOperation = 'lighter';
      // thick inner stroke (neon)
      ctx.beginPath();
      ctx.lineWidth = Math.max(1, b.width * 8) * b.life;
      ctx.strokeStyle = `rgba(141,224,255,${0.9 * b.life})`;
      let prevx = b.x, prevy = b.y;
      for(let s=1;s<=segs;s++){
        const t = s / segs;
        const nx = b.x + (b.ex - b.x) * t + (Math.random()-0.5) * 24 * (1 - t);
        const ny = b.y + (b.ey - b.y) * t + (Math.random()-0.5) * 24 * (1 - t);
        ctx.lineTo(nx, ny);
        prevx = nx; prevy = ny;
      }
      ctx.stroke();

      // outer soft stroke
      ctx.beginPath();
      ctx.lineWidth = Math.max(1, b.width * 18) * b.life;
      ctx.strokeStyle = `rgba(140,210,255,${0.16 * b.life})`;
      ctx.moveTo(b.x, b.y); ctx.lineTo(b.ex, b.ey); ctx.stroke();

      // add sparkle particles around tip
      if(Math.random() < 0.15){
        spawnParticles(b.ex, b.ey, 6);
      }

      b.life -= b.decay;
      if(b.life <= 0) bolts.splice(i,1);
      // spawn branching occasionally for drama
      if(Math.random() < 0.006 && b.life > 0.6 && b.branch === false){
        spawnBolt((b.x + b.ex)/2 + (Math.random()-0.5)*80, (b.y + b.ey)/2 + (Math.random()-0.5)*80, 0.6, true);
      }
    }
    ctx.globalCompositeOperation = 'source-over';

    // particles
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      ctx.beginPath();
      ctx.fillStyle = `rgba(200,240,255,${0.85 * p.life})`;
      ctx.arc(p.x, p.y, p.r * p.life, 0, Math.PI*2);
      ctx.fill();
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.06; // gravity slight
      p.life -= p.decay;
      if(p.life <= 0 || p.y > H + 50) particles.splice(i,1);
    }

    // flash overlay
    if(flash > 0.01){
      ctx.fillStyle = `rgba(255,245,230,${Math.min(0.9, flash)})`;
      ctx.fillRect(0,0,W,H);
      flash *= 0.88;
      if(flash < 0.02) flash = 0;
    }

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // gently spawn ambient bolts occasionally (sparse)
  setInterval(()=> {
    if(Math.random() < 0.6) return;
    const x = Math.random() * W;
    const y = Math.random() * H * 0.5;
    spawnBolt(x, y, 1.0, false);
  }, 2000);

  // expose toggle variable
  window.ANIME_LIGHTING = true;
})();

/* ===========================
   Lightweight notes:
   - Для слабых ПК можно отключить молнии кнопкой "Молнии: Выкл".
   - Всё масштабируется относительно окна, canvas responsive.
   - Если хотите звук при вспышках — могу добавить опционально.
   =========================== */
   /* ========================
   Дополнение: облака + неоновые всполохи
   ======================== */
(function(){
  const canvas = document.getElementById('bg-canvas');
  const ctx = canvas.getContext('2d', {alpha:true});
  let w = innerWidth, h = innerHeight;

  // Создаём облачные слои
  const clouds = [];
  for(let i=0;i<8;i++){
    clouds.push({
      x: Math.random()*w,
      y: Math.random()*h*0.6,
      r: 120 + Math.random()*180,
      a: 0.05 + Math.random()*0.08,
      speed: 0.05 + Math.random()*0.12,
    });
  }

  // Неоновая подсветка фона
  let neonPhase = 0;

  function drawClouds(){
    neonPhase += 0.005;
    for(const c of clouds){
      c.x += c.speed;
      if(c.x - c.r > w) c.x = -c.r;
      const grd = ctx.createRadialGradient(c.x, c.y, 0, c.x, c.y, c.r);
      grd.addColorStop(0, `rgba(255,255,255,${c.a*0.8})`);
      grd.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.fillStyle = grd;
      ctx.fillRect(c.x-c.r, c.y-c.r, c.r*2, c.r*2);
    }

    // Неоновая лёгкая волна по экрану
    const glow = Math.sin(neonPhase)*0.2 + 0.4;
    const grd2 = ctx.createLinearGradient(0,0,w,h);
    grd2.addColorStop(0, `rgba(255,220,180,${glow*0.05})`);
    grd2.addColorStop(1, `rgba(180,220,255,${glow*0.05})`);
    ctx.fillStyle = grd2;
    ctx.fillRect(0,0,w,h);
  }

  // Встраиваем в существующий цикл рисования lightning
  const originalDraw = requestAnimationFrame;
  const observer = new MutationObserver(()=>{
    // ждём, пока оригинальный draw() появится
    if(typeof window.requestAnimationFrame === 'function'){
      // перехват цикла
      const raf = window.requestAnimationFrame;
      window.requestAnimationFrame = function(fn){
        return raf(function(){
          drawClouds();
          fn();
        });
      };
      observer.disconnect();
    }
  });
  observer.observe(document.documentElement, {childList:false, subtree:true});
})();
</script>
</body>
</html>(ma

