<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scarlet System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
    <style>
        @keyframes flicker {
            0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100% {
                opacity: 1;
            }
            20%, 21.999%, 63%, 63.999%, 65%, 69.999% {
                opacity: 0.4;
            }
        }
        
        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }
            100% {
                transform: translateY(100vh);
            }
        }
        
        .boot-screen {
            animation: flicker 8s linear infinite;
        }
        
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(255, 0, 0, 0.5);
            z-index: 9999;
            pointer-events: none;
            animation: scanline 4s linear infinite;
            mix-blend-mode: overlay;
        }
        
        .window-shadow {
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.8), 0 6px 30px rgba(255, 0, 0, 0.3);
        }
        
        .taskbar {
            backdrop-filter: blur(10px);
            background: rgba(10, 0, 0, 0.8);
        }
        
        .desktop-icon {
            transition: all 0.2s ease;
        }
        
        .desktop-icon:hover {
            background: rgba(255, 0, 0, 0.2);
        }
        
        .window {
            transition: all 0.3s ease;
            min-width: 300px;
            min-height: 200px;
        }
        
        .window-header {
            user-select: none;
            background: linear-gradient(to right, #1a0000, #400000);
        }
        
        .window-content {
            overscroll-behavior: contain;
            background: rgba(10, 0, 0, 0.9);
        }
        
        .login-screen {
            background: linear-gradient(135deg, #1a0000, #400000, #800000);
        }
        
        .login-form {
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
        }
        
        .btn {
            transition: all 0.2s ease;
            background: linear-gradient(to right, #800000, #400000);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .start-menu {
            transition: all 0.3s ease;
            transform-origin: bottom left;
            background: rgba(20, 0, 0, 0.95);
            border: 1px solid #400000;
        }
        
        .pinball {
            background: #000;
            border: 4px solid #800000;
            border-radius: 2px;
        }
        
        .flipper {
            background: #800000;
            border: 2px solid #ff0000;
        }
        
        .bumper {
            background: radial-gradient(circle, #ff0000, #800000);
            box-shadow: 0 0 10px #ff0000;
        }
        
        .plunger {
            background: linear-gradient(to bottom, #800000, #400000);
            border: 2px solid #ff0000;
        }
        
        .ball {
            background: radial-gradient(circle, #fff, #ccc);
            box-shadow: 0 0 5px #fff;
        }
        
        .file-upload {
            border: 2px dashed #800000;
        }
        
        .file-upload:hover {
            background: rgba(255, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-black text-red-400 font-mono overflow-hidden select-none">
    <!-- Vanta.js Background -->
    <div id="vanta-bg" class="fixed inset-0 z-0"></div>
    
    <!-- Boot Screen -->
    <div id="boot-screen" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center boot-screen">
        <div class="text-center mb-8">
            <div class="text-4xl mb-2 text-red-500">SCARLET SYSTEM</div>
            <div class="text-xl">Initializing...</div>
        </div>
        <div class="w-64 h-1 bg-gray-800 rounded-full overflow-hidden">
            <div id="boot-progress" class="h-full bg-red-600" style="width: 0%"></div>
        </div>
        <div class="mt-4 text-sm text-gray-600">Â© 2023 SCARLET CORP</div>
    </div>
    
    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 z-40 hidden login-screen flex items-center justify-center">
        <div class="login-form bg-black bg-opacity-90 rounded-lg p-8 w-96 border border-red-900">
            <div class="text-center mb-8">
                <div class="text-3xl mb-2 text-red-500">SCARLET SYSTEM</div>
                <div class="text-sm text-red-400">Authentication Required</div>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm mb-2">Username</label>
                <input type="text" class="w-full bg-black border border-red-900 rounded px-3 py-2 focus:outline-none focus:border-red-500 text-white" value="user">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm mb-2">Password</label>
                <input type="password" class="w-full bg-black border border-red-900 rounded px-3 py-2 focus:outline-none focus:border-red-500 text-white" value="password">
            </div>
            
            <button id="login-btn" class="w-full text-white py-2 rounded btn hover:bg-red-800">
                Login
            </button>
        </div>
    </div>
    
    <!-- Desktop -->
    <div id="desktop" class="fixed inset-0 hidden z-30">
        <!-- Desktop Icons -->
        <div class="absolute left-4 top-4 flex flex-col space-y-4">
            <div class="desktop-icon flex flex-col items-center w-16 p-2 rounded cursor-pointer" data-window="wallpaper">
                <div class="w-12 h-12 bg-red-900 rounded flex items-center justify-center mb-1">
                    <i data-feather="image" class="text-red-400"></i>
                </div>
                <span class="text-xs text-center text-white">Wallpaper</span>
            </div>
            
            <div class="desktop-icon flex flex-col items-center w-16 p-2 rounded cursor-pointer" data-window="pinball">
                <div class="w-12 h-12 bg-red-900 rounded flex items-center justify-center mb-1">
                    <i data-feather="cpu" class="text-red-400"></i>
                </div>
                <span class="text-xs text-center text-white">Pinball</span>
            </div>
            
            <div class="desktop-icon flex flex-col items-center w-16 p-2 rounded cursor-pointer" data-window="settings">
                <div class="w-12 h-12 bg-red-900 rounded flex items-center justify-center mb-1">
                    <i data-feather="settings" class="text-red-400"></i>
                </div>
                <span class="text-xs text-center text-white">Settings</span>
            </div>
        </div>
        
        <!-- Windows -->
        <div id="windows-container" class="absolute inset-0 pointer-events-none">
            <!-- Windows will be dynamically added here -->
        </div>
        
        <!-- Taskbar -->
        <div class="absolute bottom-0 left-0 right-0 h-10 taskbar flex items-center px-2 border-t border-red-900 z-40">
            <button id="start-btn" class="h-8 px-3 flex items-center rounded hover:bg-red-900 mr-2">
                <i data-feather="power" class="w-4 h-4 mr-2 text-red-400"></i>
                <span class="text-white">Start</span>
            </button>
            
            <div id="taskbar-items" class="flex-1 flex items-center space-x-1 overflow-x-auto">
                <!-- Taskbar items will be added here -->
            </div>
            
            <div class="text-xs px-2 py-1 bg-black rounded border border-red-900">
                <span id="clock" class="text-red-400">00:00</span>
            </div>
        </div>
        
        <!-- Start Menu -->
        <div id="start-menu" class="absolute bottom-10 left-0 w-64 rounded-tr-lg rounded-b-lg border border-red-900 window-shadow hidden start-menu origin-bottom-left z-50">
            <div class="p-2 border-b border-red-900 window-header flex justify-between items-center">
                <div class="font-medium text-red-400">Start Menu</div>
                <button class="p-1 hover:bg-red-900 rounded">
                    <i data-feather="x" class="w-4 h-4 text-red-400"></i>
                </button>
            </div>
            
            <div class="p-2 window-content">
                <div class="mb-4">
                    <div class="text-xs text-red-600 uppercase mb-1">Applications</div>
                    <div class="space-y-1">
                        <a href="#" class="block px-2 py-1 hover:bg-red-900 rounded flex items-center text-white" data-window="wallpaper">
                            <i data-feather="image" class="w-4 h-4 mr-2 text-red-400"></i>
                            <span>Wallpaper</span>
                        </a>
                        <a href="#" class="block px-2 py-1 hover:bg-red-900 rounded flex items-center text-white" data-window="pinball">
                            <i data-feather="cpu" class="w-4 h-4 mr-2 text-red-400"></i>
                            <span>Pinball</span>
                        </a>
                        <a href="#" class="block px-2 py-1 hover:bg-red-900 rounded flex items-center text-white" data-window="settings">
                            <i data-feather="settings" class="w-4 h-4 mr-2 text-red-400"></i>
                            <span>Settings</span>
                        </a>
                    </div>
                </div>
                
                <div class="border-t border-red-900 pt-2">
                    <a href="#" class="block px-2 py-1 hover:bg-red-900 rounded flex items-center text-white" id="shutdown-btn">
                        <i data-feather="power" class="w-4 h-4 mr-2 text-red-400"></i>
                        <span>Shutdown</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Window Templates -->
    <template id="window-template">
        <div class="window absolute rounded-lg border border-red-900 window-shadow flex flex-col pointer-events-auto" style="width: 600px; height: 400px;">
            <div class="p-2 border-b border-red-900 window-header flex justify-between items-center cursor-move">
                <div class="font-medium flex items-center text-white">
                    <i class="window-icon w-4 h-4 mr-2 text-red-400"></i>
                    <span class="window-title">Window</span>
                </div>
                <div class="flex space-x-1">
                    <button class="window-minimize p-1 hover:bg-red-900 rounded">
                        <i data-feather="minus" class="w-4 h-4 text-red-400"></i>
                    </button>
                    <button class="window-maximize p-1 hover:bg-red-900 rounded">
                        <i data-feather="maximize-2" class="w-4 h-4 text-red-400"></i>
                    </button>
                    <button class="window-close p-1 hover:bg-red-700 rounded">
                        <i data-feather="x" class="w-4 h-4 text-white"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-auto window-content p-4 text-white">
                <!-- Content will be added here -->
            </div>
            <div class="h-4 border-t border-red-900 flex items-center px-2 text-xs text-red-400">
                <span class="window-status">Ready</span>
            </div>
        </div>
    </template>
    
    <!-- Wallpaper Content -->
    <template id="wallpaper-content">
        <div>
            <h2 class="text-xl mb-4 text-red-400">Wallpaper Settings</h2>
            <div class="mb-6">
                <div class="file-upload rounded-lg p-8 text-center cursor-pointer mb-4" id="wallpaper-upload">
                    <i data-feather="upload" class="w-8 h-8 mx-auto mb-2 text-red-400"></i>
                    <p class="text-red-400">Click to upload wallpaper</p>
                    <p class="text-xs text-gray-500 mt-1">Supported formats: JPG, PNG</p>
                    <input type="file" id="wallpaper-input" accept="image/*" class="hidden">
                </div>
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-black border border-red-900 rounded p-2 cursor-pointer" data-wallpaper="1">
                        <img src="http://static.photos/red/300x200/1" class="w-full h-24 object-cover rounded">
                    </div>
                    <div class="bg-black border border-red-900 rounded p-2 cursor-pointer" data-wallpaper="2">
                        <img src="http://static.photos/red/300x200/2" class="w-full h-24 object-cover rounded">
                    </div>
                    <div class="bg-black border border-red-900 rounded p-2 cursor-pointer" data-wallpaper="3">
                        <img src="http://static.photos/red/300x200/3" class="w-full h-24 object-cover rounded">
                    </div>
                </div>
            </div>
            <div class="border-t border-red-900 pt-4">
                <h3 class="text-lg mb-2 text-red-400">Live Wallpaper</h3>
                <div class="grid grid-cols-2 gap-4">
                    <button class="bg-black border border-red-900 rounded p-3 text-left hover:bg-red-900" data-effect="waves">
                        <i data-feather="wind" class="w-6 h-6 mb-2 text-red-400"></i>
                        <div class="text-white">Blood Waves</div>
                    </button>
                    <button class="bg-black border border-red-900 rounded p-3 text-left hover:bg-red-900" data-effect="cells">
                        <i data-feather="activity" class="w-6 h-6 mb-2 text-red-400"></i>
                        <div class="text-white">Pulse Cells</div>
                    </button>
                </div>
            </div>
        </div>
    </template>
    
    <!-- Pinball Content -->
    <template id="pinball-content">
        <div class="h-full flex flex-col">
            <h2 class="text-xl mb-4 text-red-400">Scarlet Pinball</h2>
            <div class="flex-1 flex items-center justify-center">
                <canvas id="pinball-canvas" width="500" height="700" class="pinball"></canvas>
            </div>
            <div class="flex justify-between items-center mt-4">
                <div class="text-white">
                    Score: <span id="pinball-score">0</span>
                </div>
                <button id="pinball-start" class="bg-red-900 hover:bg-red-800 text-white px-4 py-1 rounded">
                    Start Game
                </button>
            </div>
        </div>
    </template>
    
    <!-- Settings Content -->
    <template id="settings-content">
        <div>
            <h2 class="text-xl mb-4 text-red-400">System Settings</h2>
            <div class="space-y-6">
                <div>
                    <h3 class="text-lg mb-2 text-red-400">Appearance</h3>
                    <div class="bg-black border border-red-900 rounded p-4">
                        <div class="mb-4">
                            <label class="block text-sm mb-2 text-white">Theme Color</label>
                            <div class="flex space-x-2">
                                <button class="w-8 h-8 rounded-full bg-red-900 border-2 border-red-600"></button>
                                <button class="w-8 h-8 rounded-full bg-black border-2 border-gray-600"></button>
                                <button class="w-8 h-8 rounded-full bg-gray-900 border-2 border-gray-400"></button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm mb-2 text-white">Window Style</label>
                            <select class="w-full bg-black border border-red-900 rounded px-3 py-2 text-white">
                                <option>Classic</option>
                                <option>Modern</option>
                                <option>Minimal</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg mb-2 text-red-400">System</h3>
                    <div class="bg-black border border-red-900 rounded p-4">
                        <div class="mb-4">
                            <label class="block text-sm mb-2 text-white">Performance Mode</label>
                            <div class="flex items-center">
                                <input type="checkbox" id="performance-mode" class="mr-2">
                                <label for="performance-mode" class="text-sm text-white">Enable high performance mode</label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm mb-2 text-white">System Information</label>
                            <div class="text-xs text-gray-400">
                                <div>OS: Scarlet System v1.0</div>
                                <div>Memory: 8GB</div>
                                <div>Processor: Quantum X-9000</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <!-- Scanline Effect -->
    <div class="scanline"></div>
    
    <script>
        // Initialize feather icons
        feather.replace();
        
        // Vanta.js background
        let vantaEffect;
        function initVanta(effect = 'waves') {
            if (vantaEffect) vantaEffect.destroy();
            
            if (effect === 'waves') {
                vantaEffect = VANTA.WAVES({
                    el: "#vanta-bg",
                    mouseControls: true,
                    touchControls: true,
                    gyroControls: false,
                    minHeight: 200.00,
                    minWidth: 200.00,
                    scale: 1.00,
                    scaleMobile: 1.00,
                    color: 0x800000,
                    shininess: 35.00,
                    waveHeight: 15.00,
                    waveSpeed: 0.85,
                    zoom: 0.75
                });
            } else if (effect === 'cells') {
                vantaEffect = VANTA.CELLS({
                    el: "#vanta-bg",
                    mouseControls: true,
                    touchControls: true,
                    gyroControls: false,
                    minHeight: 200.00,
                    minWidth: 200.00,
                    scale: 1.00,
                    color1: 0x800000,
                    color2: 0x0,
                    size: 1.20,
                    speed: 1.10
                });
            }
        }
        
        // Boot sequence
        let bootProgress = 0;
        const bootInterval = setInterval(() => {
            bootProgress += Math.random() * 10;
            if (bootProgress > 100) bootProgress = 100;
            document.getElementById('boot-progress').style.width = `${bootProgress}%`;
            
            if (bootProgress >= 100) {
                clearInterval(bootInterval);
                setTimeout(() => {
                    document.getElementById('boot-screen').classList.add('hidden');
                    document.getElementById('login-screen').classList.remove('hidden');
                }, 500);
            }
        }, 300);
        
        // Login
        document.getElementById('login-btn').addEventListener('click', () => {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('desktop').classList.remove('hidden');
            updateClock();
            setInterval(updateClock, 1000);
            initVanta('waves');
        });
        
        // Clock
        function updateClock() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}`;
        }
        
        // Window management
        let zIndex = 10;
        let activeWindow = null;
        const windows = {};
        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        
        function createWindow(type) {
            const template = document.getElementById('window-template').content.cloneNode(true);
            const windowEl = template.querySelector('.window');
            const contentTemplate = document.getElementById(`${type}-content`).content.cloneNode(true);
            
            // Set window properties
            windowEl.querySelector('.window-content').appendChild(contentTemplate);
            windowEl.style.zIndex = zIndex++;
            windowEl.style.left = `${Math.random() * 200}px`;
            windowEl.style.top = `${Math.random() * 100}px`;
            
            // Set window title and icon
            const titles = {
                'wallpaper': { title: 'Wallpaper', icon: 'image' },
                'pinball': { title: 'Pinball', icon: 'cpu' },
                'settings': { title: 'Settings', icon: 'settings' }
            };
            
            windowEl.querySelector('.window-title').textContent = titles[type].title;
            const iconEl = windowEl.querySelector('.window-icon');
            iconEl.setAttribute('data-feather', titles[type].icon);
            feather.replace(iconEl);
            
            // Add to DOM
            document.getElementById('windows-container').appendChild(windowEl);
            
            // Make draggable
            makeDraggable(windowEl);
            
            // Window controls
            const closeBtn = windowEl.querySelector('.window-close');
            const minimizeBtn = windowEl.querySelector('.window-minimize');
            const maximizeBtn = windowEl.querySelector('.window-maximize');
            
            closeBtn.addEventListener('click', () => {
                windowEl.remove();
                delete windows[type];
                updateTaskbar();
                
                if (type === 'pinball') {
                    clearInterval(pinballInterval);
                }
            });
            
            minimizeBtn.addEventListener('click', () => {
                windowEl.style.opacity = '0';
                windowEl.style.pointerEvents = 'none';
            });
            
            maximizeBtn.addEventListener('click', () => {
                if (windowEl.style.width === '100%' && windowEl.style.height === 'calc(100% - 40px)') {
                    windowEl.style.width = '600px';
                    windowEl.style.height = '400px';
                    windowEl.style.left = '50px';
                    windowEl.style.top = '50px';
                } else {
                    windowEl.style.width = '100%';
                    windowEl.style.height = 'calc(100% - 40px)';
                    windowEl.style.left = '0';
                    windowEl.style.top = '0';
                }
            });
            
            // Focus window when clicked
            windowEl.addEventListener('mousedown', () => {
                windowEl.style.zIndex = zIndex++;
                activeWindow = windowEl;
            });
            
            // Add to windows object
            windows[type] = windowEl;
            
            // Update taskbar
            updateTaskbar();
            
            // Initialize window-specific functionality
            if (type === 'wallpaper') {
                initWallpaperWindow(windowEl);
            } else if (type === 'pinball') {
                initPinballWindow(windowEl);
            }
            
            return windowEl;
        }
        
        function makeDraggable(element) {
            const header = element.querySelector('.window-header');
            
            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                const rect = element.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                element.style.cursor = 'grabbing';
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                element.style.left = `${e.clientX - dragOffsetX}px`;
                element.style.top = `${e.clientY - dragOffsetY}px`;
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
                element.style.cursor = '';
            });
        }
        
        function updateTaskbar() {
            const taskbar = document.getElementById('taskbar-items');
            taskbar.innerHTML = '';
            
            for (const [type, windowEl] of Object.entries(windows)) {
                const titles = {
                    'wallpaper': 'Wallpaper',
                    'pinball': 'Pinball',
                    'settings': 'Settings'
                };
                
                const btn = document.createElement('button');
                btn.className = 'h-8 px-3 flex items-center rounded hover:bg-red-900 text-white';
                btn.innerHTML = `<span>${titles[type]}</span>`;
                
                btn.addEventListener('click', () => {
                    windowEl.style.zIndex = zIndex++;
                    windowEl.style.opacity = '1';
                    windowEl.style.pointerEvents = 'auto';
                });
                
                taskbar.appendChild(btn);
            }
        }
        
        // Start menu
        const startBtn = document.getElementById('start-btn');
        const startMenu = document.getElementById('start-menu');
        
        startBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            startMenu.classList.toggle('hidden');
            if (!startMenu.classList.contains('hidden')) {
                startMenu.style.transform = 'scale(1)';
            } else {
                startMenu.style.transform = 'scale(0)';
            }
        });
        
        document.addEventListener('click', (e) => {
            if (!startMenu.contains(e.target) && e.target !== startBtn) {
                startMenu.classList.add('hidden');
                startMenu.style.transform = 'scale(0)';
            }
        });
        
        // Desktop icons
        document.querySelectorAll('.desktop-icon').forEach(icon => {
            icon.addEventListener('dblclick', () => {
                const type = icon.getAttribute('data-window');
                createWindow(type);
            });
        });
        
        // Start menu items
        document.querySelectorAll('[data-window]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const type = item.getAttribute('data-window');
                if (!windows[type]) {
                    createWindow(type);
                } else {
                    windows[type].style.zIndex = zIndex++;
                    windows[type].style.opacity = '1';
                    windows[type].style.pointerEvents = 'auto';
                }
                startMenu.classList.add('hidden');
                startMenu.style.transform = 'scale(0)';
            });
        });
        
        // Shutdown
        document.getElementById('shutdown-btn').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('desktop').classList.add('hidden');
            document.getElementById('boot-screen').classList.remove('hidden');
            document.getElementById('boot-progress').style.width = '0%';
            bootProgress = 0;
            
            if (vantaEffect) vantaEffect.destroy();
            
            const bootInterval = setInterval(() => {
                bootProgress += Math.random() * 10;
                if (bootProgress > 100) bootProgress = 100;
                document.getElementById('boot-progress').style.width = `${bootProgress}%`;
                
                if (bootProgress >= 100) {
                    clearInterval(bootInterval);
                    setTimeout(() => {
                        document.getElementById('boot-screen').classList.add('hidden');
                        document.getElementById('login-screen').classList.remove('hidden');
                    }, 500);
                }
            }, 300);
            
            // Close all windows
            document.getElementById('windows-container').innerHTML = '';
            for (const type in windows) {
                delete windows[type];
            }
            updateTaskbar();
        });
        
        // Wallpaper window functionality
        function initWallpaperWindow(windowEl) {
            const uploadArea = windowEl.querySelector('#wallpaper-upload');
            const fileInput = windowEl.querySelector('#wallpaper-input');
            
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        document.body.style.backgroundImage = `url(${event.target.result})`;
                        document.body.style.backgroundSize = 'cover';
                        document.body.style.backgroundPosition = 'center';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Preset wallpapers
            windowEl.querySelectorAll('[data-wallpaper]').forEach(el => {
                el.addEventListener('click', () => {
                    const num = el.getAttribute('data-wallpaper');
                    document.body.style.backgroundImage = `url(http://static.photos/red/1200x630/${num})`;
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundPosition = 'center';
                });
            });
            
            // Live wallpaper buttons
            windowEl.querySelector('[data-effect="waves"]').addEventListener('click', () => {
                initVanta('waves');
            });
            
            windowEl.querySelector('[data-effect="cells"]').addEventListener('click', () => {
                initVanta('cells');
            });
        }
        
        // Pinball game
        let pinballInterval;
        let pinballScore = 0;
        
        function initPinballWindow(windowEl) {
            const canvas = windowEl.querySelector('#pinball-canvas');
            const ctx = canvas.getContext('2d');
            const startBtn = windowEl.querySelector('#pinball-start');
            const scoreDisplay = windowEl.querySelector('#pinball-score');
            
            // Game state
            let ball = { x: 250, y: 650, radius: 10, dx: 0, dy: 0 };
            let leftFlipper = { x: 150, y: 650, width: 60, height: 10, angle: -30 };
            let rightFlipper = { x: 350, y: 650, width: 60, height: 10, angle: 30 };
            let bumpers = [
                { x: 150, y: 200, radius: 30 },
                { x: 350, y: 200, radius: 30 },
                { x: 250, y: 300, radius: 40 }
            ];
            let gameRunning = false;
            
            // Draw functions
            function drawBall() {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
                ctx.closePath();
            }
            
            function drawFlippers() {
                // Left flipper
                ctx.save();
                ctx.translate(leftFlipper.x, leftFlipper.y);
                ctx.rotate(leftFlipper.angle * Math.PI / 180);
                ctx.fillStyle = '#800000';
                ctx.fillRect(0, -leftFlipper.height/2, leftFlipper.width, leftFlipper.height);
                ctx.strokeStyle = '#ff0000';
                ctx.strokeRect(0, -leftFlipper.height/2, leftFlipper.width, leftFlipper.height);
                ctx.restore();
                
                // Right flipper
                ctx.save();
                ctx.translate(rightFlipper.x, rightFlipper.y);
                ctx.rotate(rightFlipper.angle * Math.PI / 180);
                ctx.fillStyle = '#800000';
                ctx.fillRect(-rightFlipper.width, -rightFlipper.height/2, rightFlipper.width, rightFlipper.height);
                ctx.strokeStyle = '#ff0000';
                ctx.strokeRect(-rightFlipper.width, -rightFlipper.height/2, rightFlipper.width, rightFlipper.height);
                ctx.restore();
            }
            
            function drawBumpers() {
                bumpers.forEach(bumper => {
                    ctx.beginPath();
                    ctx.arc(bumper.x, bumper.y, bumper.radius, 0, Math.PI * 2);
                    const gradient = ctx.createRadialGradient(
                        bumper.x, bumper.y, bumper.radius * 0.3,
                        bumper.x, bumper.y, bumper.radius
                    );
                    gradient.addColorStop(0, '#ff0000');
                    gradient.addColorStop(1, '#800000');
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    ctx.strokeStyle = '#ff0000';
                    ctx.stroke();
                    ctx.closePath();
                });
            }
            
            function drawTable() {
                // Table border
                ctx.strokeStyle = '#800000';
                ctx.lineWidth = 4;
                ctx.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
                
                // Plunger
                ctx.fillStyle = '#400000';
                ctx.fillRect(230, 680, 40, 15);
                ctx.strokeStyle = '#800000';
                ctx.strokeRect(230, 680, 40, 15);
            }
            
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawTable();
                drawBumpers();
                drawFlippers();
                drawBall();
            }
            
            // Game logic
            function update() {
                // Move ball
                if (gameRunning) {
                    ball.x += ball.dx;
                    ball.y += ball.dy;
                    
                    // Wall collisions
                    if (ball.x - ball.radius < 4 || ball.x + ball.radius > canvas.width - 4) {
                        ball.dx = -ball.dx * 0.9;
                    }
                    if (ball.y - ball.radius < 4) {
                        ball.dy = -ball.dy * 0.9;
                    }
                    
                    // Bottom out
                    if (ball.y + ball.radius > canvas.height) {
                        gameRunning = false;
                        startBtn.textContent = 'Try Again';
                        ball.dx = 0;
                        ball.dy = 0;
                    }
                    
                    // Bumper collisions
                    bumpers.forEach(bumper => {
                        const dx = ball.x - bumper.x;
                        const dy = ball.y - bumper.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < ball.radius + bumper.radius) {
                            // Collision detected
                            const angle = Math.atan2(dy, dx);
                            ball.x = bumper.x + (ball.radius + bumper.radius) * Math.cos(angle);
                            ball.y = bumper.y + (ball.radius + bumper.radius) * Math.sin(angle);
                            
                            // Calculate new direction
                            const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy) * 1.2;
                            ball.dx = Math.cos(angle) * speed;
                            ball.dy = Math.sin(angle) * speed;
                            
                            // Add score
                            pinballScore += 100;
                            scoreDisplay.textContent = pinballScore;
                        }
                    });
                }
            }
            
            // Controls
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    leftFlipper.angle = 30;
                } else if (e.key === 'ArrowRight') {
                    rightFlipper.angle = -30;
                } else if (e.key === ' ' && !gameRunning) {
                    // Launch ball
                    ball.dx = (Math.random() - 0.5) * 5;
                    ball.dy = -10;
                    gameRunning = true;
                    pinballScore = 0;
                    scoreDisplay.textContent = '0';
                    startBtn.textContent = 'Playing...';
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowLeft') {
                    leftFlipper.angle = -30;
                } else if (e.key === 'ArrowRight') {
                    rightFlipper.angle = 30;
                }
            });
            
            // Start button
            startBtn.addEventListener('click', () => {
                if (!gameRunning) {
                    // Reset ball position
                    ball.x = 250;
                    ball.y = 650;
                    ball.dx = 0;
                    ball.dy = 0;
                    
                    // Launch after a delay
                    setTimeout(() => {
                        ball.dx = (Math.random() - 0.5) * 5;
                        ball.dy = -10;
                        gameRunning = true;
                        pinballScore = 0;
                        scoreDisplay.textContent = '0';
                        startBtn.textContent = 'Playing...';
                    }, 500);
                }
            });
            
            // Game loop
            pinballInterval = setInterval(() => {
                update();
                draw();
            }, 1000/60);
        }
    </script>
</body>
</html>
